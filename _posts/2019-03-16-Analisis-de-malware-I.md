---
layout: post
title: "Analisis de malware I"
excerpt: "Analisis de malware desde 0 con ejercicios practicos."
image: "https://hackingprofessional.github.io/Security/images/malware.jpg"
tags: 
  - Reverse Engineering
  - MalwareTech
  - Analisis estatico de malware
  - Virus.
---

El anÃ¡lisis de malware es el estudio o proceso para determinar la funcionalidad, el origen y el impacto potencial de una muestra determinada de malware, como un virus, un gusano, un troyano, un rootkit o una puerta trasera.
[Fuente Wikipedia](https://es.wikipedia.org/wiki/An%C3%A1lisis_de_malware)  
En el dia de hoy vamos aprender un poco de como realizar un analisis estatico de malware.
Para ello utilizare los ejercicios con dificultad principiantes de [MalwareTech](https://www.malwaretech.com/beginner-malware-reversing-challenges).
	- Strings1
	- Strings2
	- Strings3

### MalwareTech Ejercicio #1 - **Strings1**
Para este ejercicio iniciamos comprobando que tipo de archivo es:

```shell
file strings1.exe_
--> strings1.exe_: PE32 executable (GUI) Intel 80386, for MS Windows
```

Al identificar el tipo de archivo, procedi a ejecutarlo con wine.

```shell
wine strings1.exe_
```

La ejecucion del archivo muestra una ventana emergente con un hash en MD5, el cual probablemente sea el flag encriptado.

<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwExec1.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwExec1.png" title="Ejecucion del archivo con WINE">Iniciando un ejecutable de windows con WINE</a>.
  </figcaption>
</figure>

El paso siguiente es ver las cadenas de caracteres imprimibles del archivo.

```shell
strings strings1.exe_
```

<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwStringsFile1.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwStringsFile1.png" title="Uso del comando strings">Analizando cadenas imprimibles del ejecutable</a>.
  </figcaption>
</figure>

Como podemos ver nos imprime muchas flag, decidi pasar todas esas flag a MD5 y compararlas con el hash inicial.

```shell
for i in $(strings strings1.exe_ | grep 'FLAG'); do echo -n $i | md5sum | cut -d' ' -f1 | grep '4c827c4ca62781d707cd049da13539ee' && echo $i; done
--> FLAG{CAN-I-MAKE-IT-ANYMORE-OBVIOUS}
```

### MalwareTech Ejercicio #2 - **Strings2**
Al igual que en el primer ejercicio iniciamos validando el tipo de archivo con el siguiente comando:

```shell
file strings2.exe_
--> strings2.exe_: PE32 executable (GUI) Intel 80386, for MS Windows
```

Al identificar el tipo de archivo, procedi a ejecutarlo con wine.

```shell
wine strings2.exe_
```

La ejecucion del archivo muestra una ventana emergente con un hash en MD5, el cual probablemente sea el flag encriptado.

<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwExec2.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwExec2.png" title="Ejecucion del archivo con WINE">Iniciando un ejecutable de windows con WINE</a>.
  </figcaption>
</figure>

Examinamos las cadenas del ejecutable:

```shell
strings strings2.exe_
```

<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwStringsFile2.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwStringsFile2.png" title="Uso del comando strings">Analizando cadenas imprimibles del ejecutable</a>.
  </figcaption>
</figure>

Nuevamente examinamos las cadenas del ejecutable pero esta vez con el parametro "-eS" para que imprima en forma de caracteres de 8 bits.
Analizamos que hay una linea interesante:

```shell
strings -eS strings2.exe_
```
<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwStrings2File2.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwStrings2File2.png" title="Uso del comando strings con parametros">Examinando las cadenas del ejecutable en 8 bits</a>.
  </figcaption>
</figure>

Procedemos eliminando todas las letras "E", y listo tenemos nuestra flag.

```shell
echo 'EFELEAEGE{ESETEAECEKE-ESETEREIENEGESE-EAEREEE-EBEEESETE-ESETEREIENEGESE}' | tr -d 'E'
--> FLAG{STACK-STRINGS-AR-BST-STRINGS}
```

### MalwareTech Ejercicio #3 - **Strings3**
Al igual que en el primer ejercicio iniciamos validando el tipo de archivo con el siguiente comando:

```shell
file strings
--> strings3.exe_: PE32 executable (GUI) Intel 80386, for MS Windows
```

Al identificar el tipo de archivo, procedemos a ejecutarlo con wine.

```shell
wine strings3.exe_
```

La ejecucion del archivo muestra una ventana emergente con un hash en MD5, el cual probablemente sea el flag encriptado.

<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwExec3.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwExec3.png" title="Ejecucion del archivo con WINE">Iniciando un ejecutable de windows con WINE</a>.
  </figcaption>
</figure>

Examinamos las cadenas del ejecutable:

```shell
strings strings3.exe_
```

<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwStringsFile3.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwStringsFile3.png" title="Uso del comando strings">Examinando las cadenas del ejecutable</a>.
  </figcaption>
</figure>

Nuevamente examinamos las cadenas del ejecutable pero esta vez con el parametro "-el" para que imprima en forma de caracteres de 16 bits.

```shell
strings -el strings3.exe_
```
<figure>
  <img src="https://hackingprofessional.github.io/Security/images/MalwStrings3File3.png">
	<figcaption>
    <a href="https://hackingprofessional.github.io/Security/images/MalwStrings3File3" title="Uso del comando strings con parametros">Examinando las cadenas del ejecutable en 16 bits</a>.
  </figcaption>
</figure>

Y finalmente limpiamos los FLAGS y los comparamos con el hash inicial.
```shell
for i in $(strings -el strings3.exe_ | grep -oP 'FLAG{(.*?)}'); do echo -n $i | md5sum | cut -d' ' -f 1 | grep '1011cafbd736cdf2ae90964613c911fe' && echo $i ; done
--> FLAG{RESOURCES-ARE-POPULAR-FOR-MALWARE}
```

<cite>
Gerardo Eliasib  
Cybersecurity Analyst
</cite> 
